with final_table as (select     prefix as site_prefix,    post_author,    comment_count,    post_status,    total_posts,    post_average       from         (select            prefix,             post_author,             comment_count,            post_status,            case when post_status = 'publish' then count(post_date_gmt) 			else 0     		end as total_posts,            concat(extract(MONTH from post_date_gmt), '/', extract(YEAR from post_date_gmt)) as month_year,            to_timestamp(max(post_date_gmt), 'yyyy-mm-dd hh24:mi:ss.ff')            + ((to_timestamp(max(post_date_gmt), 'yyyy-mm-dd hh24:mi:ss.ff') - to_timestamp(min(post_date_gmt), 'yyyy-mm-dd hh24:mi:ss.ff')) / count(post_date_gmt)) as post_average        where post_status = 'publish'        group by post_author, cast(month_year as date)        from               {{ ref('posts')}}))select *from final_table